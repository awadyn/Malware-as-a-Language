#!/bin/bash

RESULTS_DIR=$1
CONFIDENCES_DIR="${RESULTS_DIR}/confidences"


# create confidence results directory if does not exist
[[ -d ${CONFIDENCES_DIR} ]] || mkdir ${CONFIDENCES_DIR}


# cleanup
rm "${CONFIDENCES_DIR}/"*


for class in 1 2 3 4 5 6 7 8 9
do
        for file in "${RESULTS_DIR}/malware_lang_${class}_"*
        do
                less "${file}" | sed -n "/1_NN/p" | sed -n "s/1_NN confidence  =  \([0-9]*.[0-9]*\).*/\1/p" >> "${CONFIDENCES_DIR}/confidences_1_nn_${class}"
                less "${file}" | sed -n "/2_NN/p" | sed -n "s/2_NN confidence  =  \([0-9]*.[0-9]*\).*/\1/p" >> "${CONFIDENCES_DIR}/confidences_2_nn_${class}"
                less "${file}" | sed -n "/5_NN/p" | sed -n "s/5_NN confidence  =  \([0-9]*.[0-9]*\).*/\1/p" >> "${CONFIDENCES_DIR}/confidences_5_nn_${class}"
                less "${file}" | sed -n "/8_NN/p" | sed -n "s/8_NN confidence  =  \([0-9]*.[0-9]*\).*/\1/p" >> "${CONFIDENCES_DIR}/confidences_8_nn_${class}"
                less "${file}" | sed -n "/9_NN/p" | sed -n "s/9_NN confidence  =  \([0-9]*.[0-9]*\).*/\1/p" >> "${CONFIDENCES_DIR}/confidences_9_nn_${class}"
                less "${file}" | sed -n "/10_NN/p" | sed -n "s/10_NN confidence  =  \([0-9]*.[0-9]*\).*/\1/p" >> "${CONFIDENCES_DIR}/confidences_10_nn_${class}"
                less "${file}" | sed -n "/20_NN/p" | sed -n "s/20_NN confidence  =  \([0-9]*.[0-9]*\).*/\1/p" >> "${CONFIDENCES_DIR}/confidences_20_nn_${class}"
        done
done


avg_confidence=0
count=0
for k in 1 2 5 8 9 10 20
do
	echo "k  =  ${k}"
	echo
	for class in 1 2 3 4 5 6 7 8 9
	do
	        for line in `less ${CONFIDENCES_DIR}/confidences_${k}_nn_${class}`
	        do
			let avg_confidence=$((avg_confidence+line)) | bc -l
			let count=${count}+1
	        done
	        #echo "average confidence for class ${class}:"
	        #echo "(${num_correct_class}*100)/${num_confidences_class}" | bc -l
	done
	
	echo "number of classifications:"
	echo ${count}
	echo "average confidence level:"
	echo ${avg_confidence}/${count}
	#echo "(${num_correct}*100)/${num_confidences}" | bc -l
	echo; echo;
	
done

