#!/bin/bash

#### number of malware executables to collect per class
COUNT=$1

#### path to external ssd storage; comment out as needed
#### fedora workstation distribution; linux os
#SOURCE_DIR="/run/media/yna03/Elements/299/malwares_by_class"
#### mac os
#SOURCE_DIR="/Volumes/Elements/299/malwares_by_class"
#### command line source directory argument
SOURCE_DIR=$2

#### path to working directory
DESTINATION_DIR="malware_by_class"


# create destination directory if it does not exist
[[ -d ${DESTINATION_DIR} ]] || mkdir ${DESTINATION_DIR}


# copy files to destination directory
for class in {1..9}
do
	# create destination directories if they do not exist
	[[ -d ${DESTINATION_DIR}/${class} ]] || mkdir ${DESTINATION_DIR}/${class}
	
	# clean up directories if they contain files
	if test "$(ls -A ${DESTINATION_DIR}/${class})"
	then
	        echo "Deleting pre-existing unparsed malwares."
	        rm ${DESTINATION_DIR}/${class}/*
	fi

	echo "Copying unparsed malwares to ${DESTINATION_DIR}/${class}"
	#### linux
    	ls ${SOURCE_DIR}/${class} | sort -R | tail "-${COUNT}" | while read file; do cp ${SOURCE_DIR}/${class}/${file} ${DESTINATION_DIR}/${class}; done
    	#### mac os (gnu coreutils)
    	#ls ${SOURCE_DIR}/${class} | gsort -R | tail "-${COUNT}" | while read file; do cp ${SOURCE_DIR}/${class}/${file} ${DESTINATION_DIR}/${class}; done
done
