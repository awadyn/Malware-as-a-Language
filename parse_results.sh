#!/bin/bash

RESULTS_DIR=$1
CLASSIFICATIONS_DIR="${RESULTS_DIR}/classifications"


# create classification results directory if does not exist
[[ -d ${CLASSIFICATIONS_DIR} ]] || mkdir ${CLASSIFICATIONS_DIR}


# cleanup
rm "${CLASSIFICATIONS_DIR}/"*


for class in 1 2 3 4 5 6 7 8 9
do
        for file in "${RESULTS_DIR}/malware_lang_${class}_"*
        do
                less "${file}" | sed -n "/1_NN/p" | sed -n "s/1_NN classification  =  \([0-9]\).*/\1/p" >> "${CLASSIFICATIONS_DIR}/classifications_1_nn_${class}"
                less "${file}" | sed -n "/2_NN/p" | sed -n "s/2_NN classification  =  \([0-9]\).*/\1/p" >> "${CLASSIFICATIONS_DIR}/classifications_2_nn_${class}"
                less "${file}" | sed -n "/5_NN/p" | sed -n "s/5_NN classification  =  \([0-9]\).*/\1/p" >> "${CLASSIFICATIONS_DIR}/classifications_5_nn_${class}"
                less "${file}" | sed -n "/8_NN/p" | sed -n "s/8_NN classification  =  \([0-9]\).*/\1/p" >> "${CLASSIFICATIONS_DIR}/classifications_8_nn_${class}"
                less "${file}" | sed -n "/9_NN/p" | sed -n "s/9_NN classification  =  \([0-9]\).*/\1/p" >> "${CLASSIFICATIONS_DIR}/classifications_9_nn_${class}"
                less "${file}" | sed -n "/10_NN/p" | sed -n "s/10_NN classification  =  \([0-9]\).*/\1/p" >> "${CLASSIFICATIONS_DIR}/classifications_10_nn_${class}"
                less "${file}" | sed -n "/20_NN/p" | sed -n "s/20_NN classification  =  \([0-9]\).*/\1/p" >> "${CLASSIFICATIONS_DIR}/classifications_20_nn_${class}"
                less "${file}" | sed -n "/30_NN/p" | sed -n "s/30_NN classification  =  \([0-9]\).*/\1/p" >> "${CLASSIFICATIONS_DIR}/classifications_30_nn_${class}"
        done
done


for k in 1 2 5 8 9 10 20
do
	echo "k  =  ${k}"
	echo
	num_classifications=0
	num_correct=0
	for class in 1 2 3 4 5 6 7 8 9
	do
	        num_classifications_class=0
	        num_correct_class=0
	        for line in `less ${CLASSIFICATIONS_DIR}/classifications_${k}_nn_${class}`
	        do
	                let num_classifications=${num_classifications}+1
	                let num_classifications_class=${num_classifications_class}+1
	                if [ "${line}" = "${class}" ]
	                then
	                        let num_correct=${num_correct}+1
	                        let num_correct_class=${num_correct_class}+1
	                fi
	        done
	        echo "accuracy for class ${class}:"
	        echo "(${num_correct_class}*100)/${num_classifications_class}" | bc -l
	done
	
	echo "number of classifications:"
	echo ${num_classifications}
	echo "number of correct classifications:"
	echo ${num_correct}
	echo
	echo "accuracy:"
	echo "(${num_correct}*100)/${num_classifications}" | bc -l
	echo; echo;
	
done

